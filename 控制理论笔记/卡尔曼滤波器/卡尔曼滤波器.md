#  一、主要公式

**预测**：
$$
\begin{aligned}
 \hat{X}_k^- &= A \cdot \hat{X}_{k-1} + B \cdot U_{k-1} \\[1.3ex]
 P_k^- &= A \cdot P_{k-1} \cdot A^T + Q
\end{aligned}
\tag{1-1 $\ast$}
$$
**更新**：
$$
\begin{align}
 K_k &= P_k^- H^T \cdot (H P_k^- H^T + R)^{-1} \\[1.3ex]
 \hat{X}_k &= \hat{X}_k^- + K_k(Z_k - H \hat{X}_k^-) \\[1.3ex]
 P_k &= (I - K_k H)P_k^-
\end{align}
\tag{1-2 $\ast$}
$$



# 二、推导

## 1.实际数学模型

实际的物理系统可以建模为：
$$
\begin{align}
X_k &= A \cdot X_{k-1} + B \cdot U_{k-1} + W_{k-1}  \\[1.3ex]
Z_k &= H \cdot X_{k-1} + V_k  \\
\end{align}
\tag{2-1}
$$

式中：

- $A$ 为系统转移矩阵，$B$为输入矩阵，$H$ 为观测矩阵；

- $W_{k-1}、V_{k-1}$为随机变量：
  - $W_{k-1}$为**状态转移**过程中的**噪声**，假定其服从正态分布，设其协方差矩阵为 **Q**；
  - $V_{k-1}$为**状态测量**过程中的**噪声**，假定其服从正态分布，设其协方差矩阵为 **R**。




## 2.卡尔曼滤波器推导

### 2.1 卡尔曼滤波器的作用

**目的：**希望得到 **k时刻** 的系统的真实状态值 $X_k$。

**输入**：

- 当前时刻（k时刻）的观测值 $Z_k$ ；
- 上个时刻（k-1时刻）的状态估计值 $\hat X_{k-1}$。

**输出**：

- 当前时刻系统状态的估计值 $\hat X_k$；
- 并期望 估计值 $\hat X_k$ 与 真实值$X_k$ 的误差最小。

### 2.2 估计当前时刻状态

- 若已经上一时刻的估计值 $\hat{X}_{k-1}$，我们可以通过**两种方法**得到当前时刻的估计值$\hat X_k$：

  1. 通过**理想的系统模型**估计：先验估计 $\hat{X}_k^-$

  $$
  \hat{X}_k^- = A \cdot \hat{X}_{k-1} + B \cdot U_{k-1}
  \tag{2-2 $\ast$}
  $$

  2. 通过**测量**估计：测量估计 $\hat X_k^+$

  $$
  \hat{X}_k^+ = H^{-1} Z_k
  \tag{2-3}
  $$

- 将两种方法估计出的结果进行**数据融合**：
  $$
  \begin{align}
  \hat{X}_k &= (I-G_k)\hat{X}_k^- + G_k \hat{X}_k^+  \\[1.3ex]
            &= \hat{X}_k^- + G_k(\hat{X}_k^+ - \hat{X}_k^-)  \\
  \end{align}
  \tag{2-3}
  $$

  - 式中：G为增益系数矩阵，为常量对角数量阵，其对角线上各元素取值范围：0 ~ 1。

- 由于 $X_k^+$由测量值 $Z_k$ 获得，而测量值 $Z_k$ 包含了测量误差 $V_k$，即：
  $$
  \left\{
  \begin{align}
  X_k^+ &= H^{-1} Z_k  \\[1.3ex]
  Z_k   &= H X_k + V_k
  \end{align}
  \right.
  \tag{2-4}
  $$
  
- 因而，从测量值中估计的真值也夹杂了**测量误差**：
  $$
  X_k^+ = X_k + H^{-1} V_k
  \tag{2-5}
  $$

- 将 式(2-5) 代入 式(2-3) 中，得：
  $$
  \begin{align}
  \hat{X}_k &= \hat{X}_k^- + G_k(\hat{X}_k^+ - \hat{X}_k^-)  \\[1.3ex]
            &= \hat{X}_k^- + G_k(X_k + H^{-1} V_k - \hat{X}_k^-)
  \end{align}
  \tag{2-6}
  $$

- 整理得：
  $$
  \begin{align}
  \hat{X}_k &= \hat{X}_k^- + G_k(X_k - \hat{X}_k^- + H^{-1} V_k )  \\[1.3ex]
            &= \hat{X}_k^- + G_k(X_k - \hat{X}_k^-) + G_k H^{-1} V_k
  \end{align}
  \tag{2-7}
  $$

- 令修正系数 $G_k = K_k \cdot H$（$K_k = G_k \cdot H^{-1}$ ），得当前时刻的状态估计值 $\hat X_k$ 为：

$$
\begin{align}
\hat{X}_k &= \hat{X}_k^- + K_k H(X_k - \hat{X}_k^-) + K_k V_k
\end{align}
\tag{2-8 $\ast$}
$$

- 观察上式，可知：

  - 当前**时刻的状态估计值** $\hat{X}_k$ 包括：
    - **先验估计项**：$\hat{X}_k^-$，由系统方程推测的估计项，
    - **修正项**：$K_k H(X_k - \hat{X}_k^-) + K_k V_k$，当前时刻的**观测值** 对先验估计的 **修正项**，

  - 其中**修正项包含了两项**：
    - **精准修正项**：$X_k - \hat{X}_k^-$，真实的实际状态与先验估计状态的偏差
    - **观测误差项**：$V_k$，由于观测误差引入的误差，
    - **修正系数**：$K_k$（$=G_k \cdot H^{-1}$），由修正系数来控制修正项的权重

  > 在理想情况下，$V_k$ = 0：
  >
  > - 则当前时刻的状态估计值仅由先验估计与精准修正项组成
  > - $\hat{X}_k = \hat{X}_k^- + K_k H(X_k - \hat{X}_k^-)$

### 2.3 计算估计协方差

- 若将 此时状态估计值 $\hat X_k$ 与 真值 $X_k$ 作比较，可令误差项 $e_k$ 为：

$$
\begin{align}
e_k  &= X_k - \hat{X}_k \\
\end{align}
\tag{2-9}
$$
- 将 式(2-9)展开，即将 式(2-8)代入 式(2-9)，得：
  $$
  \begin{align}
  e_k  &= X_k - \hat{X}_k \\[1.3ex]
       &= X_k - [\hat{X}_k^- + K_kH(X_k - \hat{X}_k^-) + K_k V_k] \\[1.3ex]
       &= (X_k - \hat{X}_k^-) - K_kH(X_k - \hat{X}_k^-) - K_k V_k \\[1.3ex]
       &= (I - K_k H)(X_k - \hat{X}_k^-) - K_k V_k
  \end{align}
  \tag{2-10}
  $$

- 再令真值 $X_k$ 与先验估计 $\hat X_k^-$ 的误差 $e_k^-$ 为：

$$
e_k^- = X_k - \hat{X}_k^-
\tag{2-11}
$$
- 则 式(2-10) 简化为：

$$
\begin{align}
e_k &= (I - K_k H)e_k^- - K_k V_k
\end{align}
\tag{2-12}
$$
- 误差项 $e_k$ 的协方差矩阵 $P_k$ 由下式计算：

$$
P = \mathbb{E}(e_k \cdot e_k^T)
\tag{2-13}
$$
- 将 式(2-12) 代入 $e_k \cdot e_k^T$，得：
  $$
  \begin{align}
   &\, e_k \cdot e_k^T  \\[1.3ex]
  =&\, [(I - K_k H)e_k^- - K_k V_k] \cdot [(I - K_k H)e_k^- - K_k V_k]^T  \\[1.3ex]
  =&\, [(I - K_k H)e_k^- - K_k V_k] \cdot [{e_k^-}^T(I - K_k H)^T - V_k^T K_k^T ]  \\[1.3ex]  
  =&\, (I - K_k H) e_k^- {e_k^-}^T (I - K_k H)^T + K_k V_k V_k^T K_k^T  \\[1.3ex]
   &\, - (I - K_k H)e_k^- V_k^T K_k^T - K_k V_k {e_k^-}^T(I - K_k H)^T  \\[1.3ex]
  \end{align}
  \tag{2-14}
  $$

- 因而，$E(e_k \cdot e_k^T)$ 为：
  $$
  \begin{alignat}{2}
  P_k =& \mathbb{E}(e_k \cdot e_k^T)  && \\[1.3ex]
      =& \mathbb{E}\left[ (I - K_k H) e_k^- {e_k^-}^T (I - K_k H)^T \right.  	% 等式1第一行前
      && +\left. K_k V_k V_k^T K_k^T \right.  \\[1.3ex]  				% 等式1第一行后
       & \left. \hspace{4.5em} - (I - K_k H)e_k^- V_k^T K_k^T \right.	% 等式1第二行前
      && -\left.  K_k V_k {e_k^-}^T(I - K_k H)^T \right]  \\[1.3ex] 	% 等式1第二行后
      =& \mathbb{E}\left[(I - K_k H) e_k^- {e_k^-}^T (I - K_k H)^T\right] 		% 等式2第一行前
      && + \mathbb{E}\left(K_k V_k V_k^T K_k^T\right)  \\[1.3ex]					% 等式2第一行后
       & \hspace{2.8em} - \mathbb{E}\left[(I - K_k H)e_k^- V_k^T K_k^T\right]	% 等式2第二行前
      && - \mathbb{E}\left[K_k V_k {e_k^-}^T(I - K_k H)^T\right]  \\[1.3ex]		% 等式2第二行后
  \end{alignat}
  \tag{2-15}
  $$

- 由于只有 $e_k^-$，$V_k$ 为随机量，而 $I$、$K_k$、$H$ 均为常量，因而：
  $$
  \left\{ 
  \begin{align}
  \mathbb{E}\left[(I - K_k H) e_k^- {e_k^-}^T (I - K_k H)^T \right] 
  &= (I - K_k H) \mathbb{E}\left(e_k^- {e_k^-}^T\right) (I - K_k H)^T  \\[1.3ex]
  
  \mathbb{E}\left(K_k V_k V_k^T K_k^T\right)
  &= K_k \mathbb{E}\left(V_k V_k^T\right) K_k^T  \\[1.3ex]
  
  \mathbb{E}\left[(I - K_k H)e_k^- V_k^T K_k^T\right] 
  &= (I - K_k H)\mathbb{E}\left(e_k^- V_k^T\right) K_k^T   \\[1.3ex]
  
  \mathbb{E}\left[K_k V_k {e_k^-}^T(I - K_k H)^T\right]
  &= K_k \mathbb{E}\left(V_k {e_k^-}^T\right)(I - K_k H)^T\\[1.3ex]
  \end{align}
  \right.
  \tag{2-16}
  $$

- 考虑到，随机变量 $e_k^-$ 与 $V_k$​ 相互独立，因而：
  $$
  \begin{align}
  \mathbb{E}(e_k^- V_k^T)   &= \mathbb{E}(e_k^-) \cdot E(V_k)^T  \\[1.3ex]
  \mathbb{E}(V_k {e_k^-}^T) &= \mathbb{E}(V_k) \cdot E({e_k^-})^T  \\
  \end{align}
  \tag{2-17}
  $$

- 并且根据假设，$V_k$​​ 为正太分布，均值为零（期望为零），即：
  $$
  \begin{align}
  \mathbb{E}(V_k)  &= 0  \\[1.3ex]
  \mathbb{E}(V_k)^T &= 0
  \end{align}
  \tag{2-18}
  $$

- 同时，设 $e_k^-$ 与 $V_k$ 的协方差矩阵为 $P_k^-$ 和 $R$，即：
  $$
  \begin{align}
  \mathbb{E}(e_k^- {e_k^-}^T) &= P_k^-  \\[1.3ex]
  \mathbb{E}(V_k V_k^T)       &= R
  \end{align}
  \tag{2-19}
  $$

- 因此，将 式(2-16) - 式(2-19)，代入到 式(2-15)，可得：
  $$
  \begin{align}
  P_k =& \mathbb{E}\left[(I - K_k H) e_k^- {e_k^-}^T (I - K_k H)^T\right]  \\[1.1ex]
       & + \mathbb{E}\left(K_k V_k V_k^T K_k^T\right)  \\[1.1ex]
       & - \mathbb{E}\left[(I - K_k H)e_k^- V_k^T K_k^T\right]  \\[1.1ex]
       & - \mathbb{E}\left[K_k V_k {e_k^-}^T(I - K_k H)^T\right]  \\[1.3ex]
      =& (I - K_k H) \mathbb{E}\left(e_k^- {e_k^-}^T\right) (I - K_k H)^T  \\[1.1ex]
       & + K_k \, \mathbb{E}\left(V_k V_k^T\right) \, K_k^T  \\[1.1ex]
       & + (I - K_k H) \, \mathbb{E}\left(e_k^- V_k^T\right) \, K_k^T  \\[1.1ex]
       & + K_k \, \mathbb{E}\left(V_k {e_k^-}^T\right) \, (I - K_k H)^T  \\[1.3ex]
      =& (I - K_k H) P_k^- (I - K_k H)^T + K_k R\, K_k^T 
  \end{align}
  \tag{2-20}
  $$

- 再将上式第一项展开：
  $$
  \begin{align}
   & (I - K_k H) P_k^- (I - K_k H)^T  \\[1.3ex]
  =& (I - K_k H) P_k^- (I - H^T K_k^T)  \\[1.3ex]
  =& (P_k^- - K_k H P_k^-)  (I - H^T K_k^T)  \\[1.3ex]
  =& P_k^- - P_k^-H^T K_k^T - K_k H P_k^- + K_k H P_k^-H^T K_k^T
  \end{align}
  \tag{2-21}
  $$

- 最终，当前时刻的协方差矩阵 $P_k$​ 表示为：
  $$
  P_k = P_k^- - P_k^-H^T K_k^T - K_k H P_k^- + K_k H P_k^-H^T K_k^T + K_k R\, K_k^T
  \tag{2-22}
  $$
  

### 2.4 获得最优修正系数

- 将协方差矩阵的迹 $tr(P_k)$（即方差）对修正系数 $K_k$ 求导：

$$
\begin{align}
\frac{\partial tr(P_k)}{\partial K} &= \frac{\partial tr(P_k^-)}{\partial K} - 
\frac{\partial tr(P_k^- H^T K_k^T)}{\partial K} - \frac{\partial tr(K_k H P_k^-)}{\partial K} + \frac{\partial tr(K_k H P_k^- H^T K_k^T)}{\partial K} + \frac{\partial tr(K_k R\, K_k^T)}{\partial K}  \\
\end{align}
\tag{2-23}
$$
- 其中第三项，由于：

$$
{(K_kHP_k^-)}^T = {P_K^-}^T H^T K_k^T
\tag{2-24}
$$
- 且协方差矩阵 $P_k^-$ 是对称矩阵，即

$$
{P_k^-}^T = P_k^-
\tag{2-25}
$$
- 所以：

$$
tr(K_kHP_k^-) = tr({P_k^-}^T H^T K_k^T)=tr(P_k^- H^T K_k^T)
\tag{2-26}
$$
- 因此第二、三项等于：

$$
\begin{align}
 & - \frac{\partial tr(K_k H P_k^-)}{\partial K_k} - \frac{\partial tr(P_k^- H^T K_k^T)}{\partial K_k}  \\
=& -2\frac{\partial tr(K_k H P_k^-)}{\partial K_k}
\end{align}
\tag{2-27}
$$
- 又根据：

$$
\begin{align}
\frac{\partial tr(AB)}{\partial A} &= B^T  \\
\frac{\partial tr(ABA^T)}{\partial A} &= 2AB  \\
\end{align}
\tag{2-28}
$$
- 所以：

$$
\begin{align}
\frac{\partial tr(P_k)}{\partial K_k} &= \frac{\partial tr(P_k^-)}{\partial K_k} - 
\frac{\partial tr(K_k H P_k^-)}{\partial K_k} - \frac{\partial tr(P_k^- H^T K_k^T)}{\partial K_k} + \frac{\partial tr(K_k H P_k^- H^T K_k^T)}{\partial K_k} + \frac{\partial tr(K_k R\, K_k^T)}{\partial K_k}  \\[1.3ex]
&= \frac{\partial tr(P_k^-)}{\partial K_k} - 2\frac{\partial tr(K_k H P_k^-)}{\partial K_k} 
+ \frac{\partial tr(K_k H P_k^- H^T K_k^T)}{\partial K_k} + \frac{\partial tr(K_k R\, K_k^T)}{\partial K_k}\\[1.3ex]
&= 0 - 2\left(H P_k^-\right)^T + 2K_k H P_k^- H^T + 2K_k R\,  \\[1.3ex]
&= - 2{P_k^-}^T H^T + 2K_k H P_k^- H^T + 2K_k R\,  \\
\end{align}
\tag{2-29}
$$
- 令方差 $tr(P_k)$ 对修正系数 $K_k$ 的导数为零：

$$
\frac{\partial tr(P_k)}{\partial K_k} = 0
\tag{2-30}
$$
- 得
  $$
  - 2{P_k^-}^T H^T + 2K_k H P_k^- H^T + 2K_k R\, &= 0  \\
  \tag{2-31}
  $$

- 再将 $K_k$ 移动到等式左侧，其余移动到等式右侧，整理得：
  $$
  \begin{align}
  - 2{P_k^-}^T H^T + 2K_k H P_k^- H^T + 2K_k R\, &= 0  \\
    K_k(H P_k^- H^T + R\,) &= {P_k^-}^T H^T  \\
    K_k &= {P_k^-}^T H^T (H P_k^- H^T + R\,)^{-1}
  \end{align}
  \tag{2-32}
  $$

- 因此，当：
  $$
  K_k = {P_k^-}^T H^T (H P_k^- H^T + R\,)^{-1}
  \tag{2-33 $\ast$}
  $$

  - 此时 $tr(P_k)$取得极值（按理说我们希望$tr(P_k)$此时为最小值，即误差方差最小，但是为什么是最小值还不知道怎么证明）

### 2.5 估计方差极值

- 回顾式(2-22) ：
  $$
  P_k = P_k^- - P_k^-H^T K_k^T - K_k H P_k^- + K_k H P_k^-H^T K_k^T + K_k R\, K_k^T  \\[1.3ex]
  $$

- 将 式(2-33) 代入 式(2-22)各项，

  - 为方便后续计算，首先计算 $K_k^T$：

  $$
  \begin{align}
  K_k^T 
  =& \left[{P_k^-}^T H^T (H P_k^- H^T + R\,)^{-1}\right]^T  \\[1.3ex]
  =& \left[(H P_k^- H^T + R\,)^{-1}\right]^T H P_k^-  \\[1.3ex]
  =& \left[(H P_k^- H^T + R\,)^T\right]^{-1} H P_k^-  \\[1.3ex]
  =& (H P_k^- H^T + R\,)^{-1} H P_k^-  \\[1.3ex]
  \end{align}
  \tag{2-33}
  $$

  - 式(2-22)第一项保留；
  - 式(2-22)第二项：

  $$
  \begin{align}
   & - P_k^-H^T K_k^T  \\[1.3ex]
  =& - P_k^-H^T (H P_k^- H^T + R\,)^{-1} H P_k^-  \\[1.3ex]
  =& - K_k H P_k^-  \\[1.3ex]
  \end{align}
  \tag{2-34}
  $$

  - 式(2-22)第三项保留；
  - 式(2-22)第四、五项：

  $$
  \begin{align}
   & K_k H P_k^-H^T K_k^T + K_k R K_k^T  \\[1.3ex]
  =& K_k \left( H P_k^-H^T + R \, \right) K_k^T  \\[1.3ex] 
  =& K_k \left( H P_k^-H^T + R \, \right) K_k^T  \\[1.3ex]
  =& {P_k^-}^T H^T (H P_k^- H^T + R \,)^{-1} 
     \left( H P_k^-H^T + R \right) (H P_k^- H^T + R)^{-1} H P_k^-  \\[1.3ex]
  =& {P_k^-}^T H^T (H P_k^- H^T + R \,)^{-1} H P_k^-  \\[1.3ex]
  =& K_k H P_k^- 
  \end{align}
  \tag{2-35}
  $$

- 最终 ，$tr(P_k)$ 的极值为：
  $$
  \begin{align}
  P_k 
  &= P_k^- - P_k^-H^T K_k^T - K_k H P_k^- + K_k H P_k^-H^T K_k^T + K_k R_k K_k^T  \\[1.3ex]
  &= P_k^- - K_k H P_k^-  - K_k H P_k^- + K_k H P_k^-  \\[1.3ex]
  &= P_k^- - K_k H P_k^-  \\[1.3ex]
  &= \left( I - K_k H \right)P_k^-  \\[1.3ex]
  \end{align}
  \tag{2-36 $\ast$}
  $$

### 2.6 协方差更新

- 回顾  式(2-1)  与 式(2-2)，实际物理模型与预测模型如下：

$$
\begin{align}
X_k &= A \cdot X_{k-1} + B \cdot U_{k-1} + W_{k-1}  \\[1.3ex]
\hat{X}_k^- &= A \cdot \hat{X}_{k-1} + B \cdot U_{k-1}
\end{align}
$$

- 回顾式(2-19)，先验估计协方差 $P_k^-$ 定义为：
  $$
  P_k^- = \mathbb{E}(e_k^- {e_k^-}^T)
  $$

- 回顾式(2-11)，其中，$e_k^-$ 为状态真值与先验估计的差值：
  $$
  e_k^- = X_k - X_k^-
  $$

- 将 式(2-1) 和 式(2-2) 代入 式(2-11)，得：
  $$
  \begin{align}
  e_k^- 
  &= A \cdot X_{k-1} + B \cdot U_{k-1} + W_{k-1} - A \cdot \hat{X}_{k-1} - B \cdot U_{k-1}  \\[1.3ex]
  &= A \cdot e_{k-1} + W_{k-1}
  \end{align}
  \tag{2-37}
  $$

- 将 式(2-37) 代入 先验协方差 $P_k^-$ 的定义，得：
  $$
  \begin{align}
  P_k^-
  &= \mathbb{E}(e_k^- {e_k^-}^T)  \\[1.3ex]
  &= \mathbb{E}\left[ \left(A \cdot e_{k-1} + W_{k-1}\right) 
     \left({A \cdot e_{k-1} + W_{k-1}}\right)^T \right]  \\[1.3ex]
  \end{align}
  \tag{2-38}
  $$

- 再将进一步上式展开：
  $$
  \begin{align}
  P_k^-
  &= \mathbb{E}\left[ \left(A \cdot e_{k-1} + W_{k-1}\right) 
     \left({e_{k-1}}^T A^T + {W_{k-1}}^T\right) \right]  \\[1.3ex]
  &= \mathbb{E}\left( A \, e_{k-1} {e_{k-1}}^T A^T + W_{k-1} {W_{k-1}}^T
      + A \, e_{k-1} {W_{k-1}}^T + W_{k-1}{e_{k-1}}^T A^T \right)  \\[1.3ex]
  &= \mathbb{E}\left( A \, e_{k-1} {e_{k-1}}^T A^T \right)
   + \mathbb{E}\left( W_{k-1} {W_{k-1}}^T \right)
   + \mathbb{E}\left( A \, e_{k-1} {W_{k-1}}^T \right)
   + \mathbb{E}\left( W_{k-1} {e_{k-1}}^T A^T \right)  \\[1.3ex]
  \end{align}
  \tag{2-39}
  $$
  
- 由于系统传递矩阵$A$ 为常量，估计误差$e_{k-1}$、与系统误差$W_{k-1}$为随机量，因而：
  $$
  \begin{align}
  \mathbb{E}\left( A \, e_{k-1} {e_{k-1}}^T A^T \right)
  &= A \, \mathbb{E}\left(e_{k-1} {e_{k-1}}^T \right) A^T 	\\[1.3ex]
  \mathbb{E}\left( A \, e_{k-1} {W_{k-1}}^T \right)
  &= A \, \mathbb{E}\left( e_{k-1} {W_{k-1}}^T \right)  	\\[1.3ex]
  \mathbb{E}\left( W_{k-1} {e_{k-1}}^T A^T \right)
  &= \mathbb{E}\left( W_{k-1}{e_{k-1}}^T \right) A^T  		\\[1.3ex]
  \end{align}
  \tag{2-40}
  $$

- 又由于估计误差$e_{k-1}$、与系统误差$W_{k-1}$ 相互独立，因而：
  $$
  \begin{align}
  \mathbb{E}\left( e_{k-1} {W_{k-1}}^T \right)
  &= \mathbb{E}\left( e_{k-1} \right) \mathbb{E}\left( {W_{k-1}}^T \right)  \\[1.3ex]
  \mathbb{E}\left( W_{k-1} {e_{k-1}}^T \right)
  &= \mathbb{E}\left( W_{k-1} \right) \mathbb{E}\left( {e_{k-1}}^T \right)
  \end{align}
  \tag{2-41}
  $$

- 系统误差$W_{k-1}$​ 服从正太分布，因此：
  $$
  \mathbb{E}\left( W_{k-1} \right) = \mathbb{E}\left( {W_{k-1}}^T \right) = 0
  \tag{2-42}
  $$

- 同时回顾 式(2-13)与 式(2-1)说明，得：
  $$
  \begin{align}
  \mathbb{E}\left(e_{k-1} {e_{k-1}}^T \right) = P_{k-1}  \\[1.3ex]
  \mathbb{E}\left(W_{k-1} {W_{k-1}}^T \right) = Q
  \end{align}
  \tag{2-43}
  $$
  
- 将 式(2-40)、式(2-41)、式(2-42) 、式(2-43)代入到 式(2-39)，得：
  $$
  \begin{align}
  P_k^-
  &= \mathbb{E}\left( A \, e_{k-1} {e_{k-1}}^T A^T \right)
   + \mathbb{E}\left( W_{k-1} {W_{k-1}}^T \right)
   + \mathbb{E}\left( A \, e_{k-1} {W_{k-1}}^T \right)
   + \mathbb{E}\left( W_{k-1} {e_{k-1}}^T A^T \right)  \\[1.3ex]
  &= A \, \mathbb{E}\left(e_{k-1} {e_{k-1}}^T \right) A^T
   + \mathbb{E}\left( W_{k-1} {W_{k-1}}^T \right)
   + A \, \mathbb{E}\left( e_{k-1} {W_{k-1}}^T \right)
   + \mathbb{E}\left( W_{k-1} {e_{k-1}}^T \right) A^T  \\[1.3ex]
  &= A P_{k-1} A^T + Q + A \cdot 0  + 0 \cdot A^T  \\[1.3ex]
  &= A P_{k-1} A^T + Q  \\[1.3ex]
  \end{align}
  \tag{2-44 $\ast$}
  $$
