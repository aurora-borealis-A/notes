# 一、vi和vim简介

## 1. vi

vi是"visual interface"的缩写，用于在终端窗口编辑文本或程序。

vi被设计时追求开发的迅速高效，因此使用vi时只用到键盘的核心区域，即字母区及一点其他附近的按键（如Esc等），鼠标与方向键都没有用。同时以命令行形式来操作文件。

## 2. vim

vim是在vi的基础上增加了一些代码补全等功能的编辑器，更利于程序员开发。vim的m是”improved“的缩写，意味着改进版。

vi和vim是**两个不同的编辑器**，vim是vi的改进版，但是大多数人都在用vim，vi很少用，因此大多数Linux系统都把**vi作为vim的软链接**，即在命令行中指令`vi`和`vim`的功能一样，都是运行vim。



# 二、打开或新建

格式：`vim 文件名 [+num]`。

说明：用vim编辑器打开文件，如果文件不存在则新建文件并编辑，如果文件已存在则直接编辑。在末尾加上 `+num`，可以使打开文件后光标定位在第num行，如果不写num，则光标在末尾。

例如：

```
vim hello.py  # 打开或新建hello.py，然后开始编辑
vim hello.py +4  # 打开hello.py，光标在第4行开头
vim hello.c +  # 打开hello.c，光标在文件末尾
```

注意：

- 如果编辑时，vim异常退出（例如文件未保存而终端窗口被强行关闭），会留下交换文件（隐藏文件），再用vim打开刚才正在编辑的文件时，会有提示，此时按下d即可，即删除交换文件。
- 交换文件是vim运行时的中间文件，用于提高vim的运行速度的，如果vim正常运行，本应该不会留下交换文件。



# 三、工作模式

三种工作模式：

- 命令行模式：编辑入口，刚进编辑界面时就是命令行模式，可以在命令模式下进行查找、复制、定位等操作。
- 编辑模式：就是普通的文本编辑模式。
- 末行模式：编辑出口，可以实现保存、退出等操作。

模式切换：

- 命令行模式下按`i`，进入编辑模式。
- 命令行模式下按`:`，进入末行模式。
- 在编辑模式、末行模式下按`Esc`：进入命令行模式。
- **编辑模式和末行模式之间没法直接切换**，得通过命令行模式过渡。

编辑流程：

1. 刚进编辑界面时为命令行模式，通过命令定位光标，然后按`i`，进入编辑模式。
2. 在编辑模式下完成编辑，然后按`Esc`回到命令行模式。
3. 在命令行模式再定位到下一处要编辑的地方，或者做复制等其他操作，然后又进入编辑模式。
4. 重复第二步和第三步，直到不需要文件全部编辑完成，在命令行模式下按`:`，进入末行模式，准备保存于退出。



# 四、末行模式

常用指令：

| 命令 | 功能                                 |
| ---- | ------------------------------------ |
| :w   | 保存（写入）                         |
| :q   | 退出                                 |
| :!q  | 强制退出（因为默认没有保存无法退出） |
| :wq  | 保存并退出（常用）                   |
| :x   | :wq的简写，保存并退出                |



# 五、命令模式

## 1. 通用指令

`数字n + 命令`：表示重复执行命令n次。

## 2. 移动光标

### 2.1 上下左右

| 命令                 | 功能         |
| -------------------- | ------------ |
| j                    | 光标向下移动 |
| k                    | 向上         |
| h                    | 向左         |
| l（这个字符大写是L） | 向右         |

### 2.2 行内移动

| 命令 | 英文     | 功能             |
| ---- | -------- | ---------------- |
| b    | backward | 光标后退一个单词 |
| w    | word     | 前进一个单词     |
| 0    |          | 行首             |
| ^    |          | 字符行首         |
| $    |          | 行尾             |

### 2.3 行间移动

| 命令            | 英文 | 功能       |
| --------------- | ---- | ---------- |
| gg              | go   | 文件顶部   |
| G               | go   | 文件末尾   |
| 20gg            | go   | 跳到第20行 |
| 20G             | go   | 跳到第20行 |
| :20（末行模式） | go   | 跳到第20行 |

记住一个g（go）就可以。

### 2.4 屏幕移动

| 命令     | 英文     | 功能     |
| -------- | -------- | -------- |
| Ctrl + b | backward | 向上滚屏 |
| Ctrl + f | forward  | 向下滚屏 |
| H        | head     | 屏幕头部 |
| M        | middle   | 屏幕中间 |
| L        | low      | 屏幕底部 |

### 2.5 程序段间移动

一段没有空行的程序，称为一段程序。

| 命令 | 功能       | 说明                                                         |
| ---- | ---------- | ------------------------------------------------------------ |
| {    | 跳到上一段 | 程序段上一行                                                 |
| }    | 跳到下一段 | 程序段下一行                                                 |
| %    | 括号匹配   | 跳到另一个匹配的括号上<br />括号包括：[]、()、{}<br />如果在括号内，则跳到前括号上 |

### 2.6 标记

| 命令 | 英文                   | 功能                                               |
| ---- | ---------------------- | -------------------------------------------------- |
| mx   | mark                   | 给当前行打上标记x，x可以是任意英文字母，区分大小写 |
| `x   | "**`**"就是quote的意思 | 跳转到标记为x的行                                  |

**注意：**

- 不用去管标记删除的事，vim会自动帮我们管理。
- 当被标记的行被删除时，对应的标记会被自动删除。
- 如果别的行被贴上了同样的标记x，原来被标记x的行就丢掉标记。

## 3. 文本操作

### 3.1 选中文本（可视模式）

| 命令     | 英文   | 功能       |
| -------- | ------ | ---------- |
| v        | visual | 可视模式   |
| V        | visual | 可视行模式 |
| Ctrl + v | visual | 可视块模式 |

**注意：**

- 可视模式也是一种工作模式。
- 从可视模式退回到命令模式行模式，用`Esc`。

### 3.2 撤销和恢复

| 命令     | 英文 | 功能 |
| -------- | ---- | ---- |
| u        | undo | 撤销 |
| Ctrl + r | redo | 恢复 |

**注意：**

- 撤销操作可以一直撤销到文件被修改前的状态，即刚打开文件时的状态。

### 3.3 删除

| 命令         | 英文   | 功能                                             |
| ------------ | ------ | ------------------------------------------------ |
| x            | cut    | 删除选中的文本，或当前光标所在的字符             |
| d + 移动命令 | delete | 删除当前光标所在位置到移动命令落点位置之间的字符 |
| dd           | delete | 删除当前行                                       |
| D            | delete | 删除到行末                                       |

d与移动命令的**常用搭配**：

- dw：删除到单词结尾.
- d}：删除到程序段结尾。
- ndd：连续删除n行。
- d0：删除到行首。
- d10G：删除到第10行。
- dG：删除到文件结尾。
- d`a：删除到标号a所在的行。

**注意：**

- 如果有选中的文本，则`x`和`d`都是删除选中文本的作用。
- 这里的删除实际上是**剪切。**

### 3.4 复制与粘贴

| 命令         | 英文  | 功能                                                         |
| ------------ | ----- | ------------------------------------------------------------ |
| y + 移动命令 | copy  | 复制当前光标所在位置到移动命令落点位置之间的字符，用法和d命令一样 |
| yy           | copy  | 复制当前行                                                   |
| p            | paste | 粘贴                                                         |

**注意：**

- 复制与删除（剪切）实际上都是把文本复制到vim的文本缓冲区中。
- 文本缓冲区的剪切板的作用一样，但是vim的文本缓冲不是系统的剪切板。
- 从别的文件Ctrl + c复制的内容，无法用p命令粘贴到文本中，需要切换到编辑模式下才能使用系统的剪切板粘贴。

### 3.5 替换

| 命令 | 英文    | 功能                               |
| ---- | ------- | ---------------------------------- |
| r    | replace | 替换当前字符                       |
| R    | replace | 进入替换模式，替换当前及以后的字符 |

**注意：**

- 替换可以在不进入编辑模式下，对文本做改动，适合文本需要微量修改的情况。

### 3.6 缩排和重复

| 命令 | 功能            |
| ---- | --------------- |
| >>   | 向右缩进4个空格 |
| <<   | 向左缩进4个空格 |
| .    | 重复上一个指令  |

连续缩进：

- 在可视模式下，选择一段程序，然后按`>`缩进（可视模式下一个`>`就够了）。
- 再按`.`，就能再次缩进
- 取消缩进的步骤也类似

### 3.7 查找

#### 3.7.1 常规查找

`/str`：查找字符串str，并高亮显示。

`n`：光标跳到**下一个**查找到的对象。

`N`：光标跳到**上一个**查找到的对象。

**注意：**

- 查找后高亮显示一直存在，如果要**取消高亮**，任意查找一个不存在的字符。

#### 3.7.2单词匹配

`*`：向后查找当前光标所在的单词。

`#`：向前查找当前光标所在的单词。

### 3.8 替换

#### 3.8.1 准备

进入**末行模式**进行查找并替换。

基本格式：`:%s///g`。s是“substitude”的意思（猜的）

#### 3.8.2 全局替换

格式：`:%s/旧文本/新文本/g`。

作用：在文件内查找旧文本，并将其替换为新文本。

#### 3.8.3 可视区替换（局部替换）

格式：`:s/旧文本/新文本/g`，比全局替换少了个百分号%。

作用：在选中的文本（用可视模式选中）中查找旧文本，并将其替换为新文本。

#### 3.8.4 确认替换

格式：`:%s/旧文本/新文本/gc`，比全局替换多了个c，c是“confirm”的意思。百分号%可以不加，为局部的确认替换。

作用：在替换一个找到的对象前前**询问是否替换**

- y：yes，替换

- n：no，不替换
- a：all，全部替换
- q：quit，退出
- l：last，最后一个替换，并把光标移到行首
- ^E：Ctrl + E，向下滚屏
- ^Y：Ctrl + F，向上滚屏



# 六、编辑模式

## 1. 进入编辑模式的6中方式

| 命令 | 英文   | 功能                             |
| ---- | ------ | -------------------------------- |
| i    | insert | 在当前光标处，进入编辑模式       |
| I    | insert | 光标跳到当前行首，进入编辑模式   |
| a    | append | 光标跳到下一个字符，进入编辑模式 |
| A    | appedn | 光标跳到当前行末，进入编辑模式   |
| o    |        | 在当前行的下一行，进入编辑模式   |
| O    |        | 在当前行的上一行，进入编辑模式   |

## 2. 示例

### 2.1 重复输入

输入5个星”*“：

- 在命令行模式下输入5，然后按`i`进入编辑模式。
- 在编辑模式下输入一个“*”，然后`Esc`回到命令行模式。
- vim会自动补全4个“\*”，总共5个“*”。
- 接着按下`.`，重复上个命令，或再生成5个*
- 这个做法相当于使用了`数字n + 命令`的语法

**注意：**

- 正常开发时，进入编辑模式前不要按数字，否则会把多余的代码复制好几份，删除会很麻烦

### 2.2 多行代码注释

对一段代码一起注释：

- 进入可视块模式，选择一段代码。
- 按`I`进入编辑模式（按`i`没有用），光标会定位到可视块的第一行。
- 然后我们可以输入'"#"或"/"等注释符号。
- 退出编辑模式时，会自动把选择的其他行也加上注释符号。



# 七、末行模式扩展

## 1. 末行命令扩展

| 命令      | 英文  | 功能                                                         |
| --------- | ----- | ------------------------------------------------------------ |
| :e 文件名 | edit  | vim打开另一个文件，相当于切换文件                            |
| :e .      | edit  | “.”表示当前文件夹，会自动打开vim内置的文件浏览器，以供选择文件并打开 |
| :n 文件名 | new   | 创建一个名叫“文件名”的新文件，然后编辑新文件                 |
| :w 文件名 | write | 把当前文件写入一个名为”文件名“的文件，相当于另存为           |

**注意：**

- 使用`:e`切换文件时，要先保存，否则不允许切换。
- `:w`另存为时，并不会打开新文件，常用于阶段性的备份工作。例如：编写完程序的一段后，输入`:w stage1`以将当前内容备份在文件stage1中，然后继续当前文件的编写。

## 2. 分屏

分屏命令：

| 命令          | 英文           | 功能                                                         |
| ------------- | -------------- | ------------------------------------------------------------ |
| :sp [文件名]  | split          | 水平分屏，分屏中打开名叫“文件名”的文件<br />如果不指定打开的文件，则再打开当前文件<br />文件名可以为”.“，会打开vim内置的文件浏览器来选择文件 |
| :vsp [文件名] | vertical split | 垂直分屏                                                     |

屏幕操作：

- 首先按下`Ctrl + w`，意为"control window"。
- 输入屏幕操作指令：
  - w（window）：切换到下一个窗口。
  - r（reverse）：交换两个窗口（多个窗口向后循环滚动，即最后的窗口移动到第一个窗口，剩下的窗口后退）。
  - c（close）：关闭当前窗口，如果是最后一个窗口则不做反应。
  - q（quit）：关闭当前窗口，如果是最后一个窗口则退出vim。
  - o（other）：关闭除当前窗口外的其他窗口。
