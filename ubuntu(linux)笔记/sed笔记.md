# sed概述

sed是”stream editor“的缩写，文本流工具。

sed处理文本时**以行为单位**进行处理，工作流程是：

- 读取文本内容到**内存**中。
- 根据指定的条件**按行筛选**内存中的文本内容。
- 对符合规则的行进行处理，然后打印处理后的行。
  - 对不符合规则的文本不进行处理，但是也打印输出，称之为默认输出。

**注意：**

- 默认sed处理的是内存中的数据，并不改变文件中的内容。
- 文本文件每行都会被sed读取，无论是否满足条件，都会被打印到命令行窗口中。

# 使用方法

**格式**：

```bash
sed [选项] [地址范围]sed内置命令及参数 [输入文件]
```

**选项**：

- `-n`：取消默认输出。常常与sed内置命令p联用。
- `-i`：把处理结果直接写入文件（默认修改的内容是内存中的内容），而不是打印到命令行窗口中。
- `-e`：多次编辑（按顺序），可以代替管道符。
- `-r`：正则扩展，否则为基础正则。

**地址范围**：

- 单行：

  - 数字：第n行

  - 最后一行：$

  - 例如：

    ```bash
    sed '3d' file.txt  # 删除第3行
    sed '$d' file.txt  # 删除最后一行
    ```

- 多行：

  - 格式：`起始行, 结束行`

  - 例如：

    ```bash
    sed -n '1, 3p' file.txt  # 打印第1至3行
    sed -n '3, $p' file.txt  # 打印第3至最后一行
    sed -n '2, +5p' file.txt  # 打印第2行至第7(2+5)行
    ```

- 模式匹配：

  - 格式：`/模式/`

  - 例如：

    ```bash
    sed -n '/hello/p' main.c  # 打印包含"hello"的行
    sed '/start/, /end/d'  # 从包含“start”行开始，一直删除到包含“end”的行
    ```

- 行号与模式匹配混合：

  - 例如：

    ```bash
    sed '/start/, $d'  # 从包含"start"的行开始，一直删除到最后一行
    ```


- 辅助功能：

  - 步长：`~步长`

  - 地址取反：`地址!`

  - 例如：

    ```bash
    sed -n '1~2p' file.txt  # 打印奇数行
    sed -n '2!p' file.txt  # 打印除了第二行的所有行
    ```

**sed内置命令**：

- 打印文本：p（print）
  - 格式：`sed [地址范围]p 文件名`
  - 常用操作：
    - 打印指定行：`sed -n 3-5p file.txt`，打印3-5行；
    - 打印匹配范围：`sed -n /if/, /end/p work.m`，打印 if 开头 end 结束的语句 。

- 添加文本：a（append）

  - 格式：`sed [地址范围]a/添加的文本 文件名`
  - 常用操作：
    - 在指定行后添加内容（内容在新行中）：`sed '3a/haha' file.txt`，在第三行下方添加”haha“。
    - 在匹配行后添加内容：`sed '/class/a/#这是一个注释' file.txt`

- 删除文本：d（delete）

- 插入文本：i（insert）

- 替换文本：s（substitute）

  - 格式：`sed [地址范围]s/匹配模式/新文本/替换选项 文件名`

    - 例如：`sed 's/python/world/g' hello.py`，则原文件中的`print("hello python!")`变为`print("hello world!")`
    - 替换选项：
      - `g`：全局替换，默认只替换每行中匹配到的第一项；
      - `p`：打印替换后的行；
      - `i`：忽略大小写。 


> - 格式中的"/"字符是分隔符，可以用任意的字符代替，
> - 因为sed只认s后的第一个字符为分隔符，所以什么离谱的符号作分隔符都可以(emoji表情都可以)，
> - 但是一般为了可读性，常用的分隔符就是`\`、`|`、`#`