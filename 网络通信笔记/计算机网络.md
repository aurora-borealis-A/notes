# 计算机网络概述

## 网络

概念：

- 网络：**多台计算机**通过交换机等设备连接起来组成网络。

- 互联网：**多个网络**连接起来，组成互联网，即网络互联组成的网络。
  - 互联网有许多种：军用互联网、政府专用互联网、因特网等，只要是多个网络连接起来都叫互联网。

- 因特网：因特网是规模最大的互联网，连接全球的网络。

因特网组成：

- 边缘设备：包括个人计算机、服务器等。
- 因特网核心：包括各种网阔设备，如：交换机和路由器等。

## 数据交换

### 数据交换方式

- 电路交换（circuit switching）
- 电报交换（message switching）
- 分组交换（package switching）

### 电路交换

电路交换的例子：电话，建立专线。因为建立了专线，通信可以保证实时性，但是同时也导致通话时他人无法介入（您拨打的电话正在通话中）。

- 电路交换适合于数据量很大的实时性传输
- 核心路由器之间会使用电路交换

### 分组交换

- 计算机网络通信中，**绝大多数都是分组交换**。

- 把报文（例如一个word文档）分成**多段发送**，其中每段数据上都会表明源地址和目标地址。

- 每段数据都通过路由器转发到下一个路由器，最后到达目标地址。

- 路由器具有存储转发功能。
- 分组交换不像电路交换那样占线，一条链路可以被任意个主机使用。

特点：

- 优点：高效、灵活、迅速、可靠。
- 缺点：时延、开销大。

### 报文交换

每次传输都要发送完整的报文，而不是将报文分组。

### 对比不同数据交换方式

分组交换可以并行传输，时间最短，效率最高。

<img src=".\图片\三种交换方式的比较.png" alt="不同数据交换方式的对比" style="zoom:50%;" />

## 计算机网络分类

作用范围：

- 广域网（WAN）
- 城域网（MAN）
- 局域网（LAN）
- 个人区域（PAN）

使用者：

- 公共网络、私有网络

拓扑结构：

- 总线型、环型、星型、数型、网状

工作方式：

- 资源子网、通信子网、接入网

## 性能指标

- 速率：连接在计算机网络上的**主机**在数字信道上传送数据位数的速率（比特率）。
  - 单位：b/s、Mb/s等，注意不是MB/s。
  - b代表bit，位。B代表byte，字节。8位一字节。
- 带宽：最大速率。
- 吞吐量：单位时间内通过某个网络的数据量的总和，也就是速率的总和。
- 时延：传送数据的延时时间
  - 排队时延：数据在网络节点缓存队列的排队时间。
  - 处理时延：路由器处理数据的时间。
  - 发送时延：发送完整数据的时间。
  - 传播时延：数据在链路中传播的时间。
- 时延带宽积：等于 时延×带宽。
- 往返时间：从发送方发送数据开始，到发送方接到接收方确认的时间。
- 利用率：
  - 信道利用率：等于 信道上有数据通过时间/信道上无数据通过时间。
  - 网络利用率：多个信道利用率的加权平均。
  - 利用率越高，时延越长。相当于马路上车越多，路越堵。
  - 利用率接近100%时，时延急剧增加。

## 网络模型

OSI （open system interconnection）：

- 应用层：能够产生网络流量、能够和用户交互的应用程序，例如：QQ。
- 表示层：加密、压缩数据。
- 会话层：服务器和客户端建立的会话，可以用于排查木马。
  - cmd命令：`netstat -n`，查看所有会话。
- 传输层：可靠传输（建立会话）、不可靠传输（不建立会话）、流量控制。
- 网络层：IP地址编址，选择最佳路径。
- 数据链路层：数据的分装、添加物理地址（MAC地址）。
- 物理层：规定了各项电气标准（如高低电平的电压标准）、接口标准（如接口有几根针头）。

实际结构：

- 应用层
- 传输层
- 网络层
- 数据链路层
- 物理层

# 物理层

物理层解决如何在连接各种计算机的传输媒体上传输数据比特流，而不是指具体的传输媒体。

常用编码：

- 单极性不归零码、双极性不归零。（检测电压）
- 单极性归零码、双极性归零码。（检测电压）
- 曼彻斯特编码。（检测跳变）
- 差分曼彻斯特编码。（检测跳变的变化）

## 信道复用

## 概述

多个信号发射端和多个信号接收端之间本应该一一对应着有多个信号。信道复用的概念是多个信号发射端的信号通过信道复用，而只使用**一个信道**来传输信息，在信号接收端前有分用装置把信号分配给多个接收端。

## 类别

- 频分复用：对多个信号使用不同的频率调制，使得每个信号调制后都占据不同的频段。由于这些信号占据不同频段，因此可以使用一个信道传输信息。

- 时分复用：一个信道被多个信号轮流占据一段时间。如果有信号空闲，仍然会被分配一定的占据时间，造成资源浪费。
  - 统计时分复用：不用轮流占据，而是谁有信号谁就用信道，但是在信号前加上标号，使得分用装置能分辨这是送给谁的信号。
- 波分复用：对多个信号调制成不同的波长，相当于频分复用。
- 码分复用CDMA（手机通讯用）：一比特位被分为m个码片，每个发送、接收端（如手机）都有自己的一组码片。
  - 同组码片平均内积后为1，例如：1 1 -1 1 与 1 1 -1 1 内积后取平均为1。
  - 不同组之间的码片应当正交，即平均内积后为0，例如：1 1 -1 1 和 1 -1 1 1 内积后取平均为 0 。
  - 当有信号来时，每个接收端都用自己的一组码片对信号作平均内积，平均内积的结果就是1、-1、0。
  - 信号是多个发送信号的叠加，每个接收端都能通过自己的码片得到属于自己的数据。

# 链路层

## 数据传输模型

<img src=".\图片\数据发送模型.png" alt="数据传输模型" style="zoom:50%;" />

数据的流动：

- 主机H1上应用程序的原始数据
  - 经过运输层被分成多端，每段数据都被编上号。
  - 经过网络层被封装上IP地址变为数据包。
  - 经过链路层封装上mac地址变为帧数据。
  - 经过物理层化为比特流，通过链路，发送到路由器R1。
- 路由器R1接收到数据后，先将比特流转为帧数据送到链路层。
  - 链路层读取mac地址后，去除帧数据的mac地址将其变为数据包送到网络层
  - 网络层获得源IP地址，目标IP地址，计算接下来应当去往哪个节点。
  - 接着再层层封装发送到下一个路由器R2。
- 数据就是从主机H1的应用层开始，**层层封装**后发送到下一个结点。
- 结点收到数据后**层层解封装**后，获得目的地址并计算接下来送往哪个节点，然后又层层封装后送入下一个结点。

## 信道类型

点对点信道：这种信道使用**一对一**，点对点的通信方式。

广播信道：这种信道使用**一对多**的广播通信方式。

## 基本概念

- 链路：一条点到点的物**理线路**，如网线和电话线等。链路是通路的一段。

- 数据链路：除了物理线路，还需要有**协议**来控制数据的传输。把实现这些协议的硬件和软件加到链路上，就构成了数据链路。
  - 最常用的方式是使用网络适配器（网卡），作为完成协议的硬件和软件。
  - 一般网络适配器都包含了链路层和物理层两层的功能。

- 帧：数据链路传输的数据叫做帧，帧有帧头和帧尾，用于表示数据的开始和结束。

## 三个基本问题

### 帧封装

在一段完整的数据前加上帧头（SOH），数据结束处加上帧尾（EOT）。

节点如果只收到帧头，没有收到帧尾，该数据会被丢弃。

节点如果只收到帧尾，没有到帧头，该数据也会被丢弃。

节点只有接收到帧头后，又收到帧尾，该数据才会被保留。

### 透明传输

- 一般帧数据中的原始数据都是由可打印的ASCII字符组成。

- 但是也可能是其他非打印字符，这些字符的二进制有可能恰好与帧尾的二进制相同，就会导致帧尾的误判。
  - 帧头同样也会有这样的情况。
  - 即原始数据里包含了代表帧头或帧尾的数据，会引发混乱。
- 因此在帧数据中中对那些代表帧头或帧尾的数据进行特殊处理，如：字节填充：在该数据前加上ESC代表转义。

- 这些包含转移字符的帧数据被接受后，会解析转义，然后去除转义字符。
- 这样在我们看来，这些转义字符好像没有出现过一样，就像透明的一样，这就是透明传输的含义。

### 差错控制

为了校验数据传输是否正确不失真，要在帧数据中加入一串帧校验序列（FCS，frame check sequence）。

CRC（cyclic redundancy check）可以用于生成一组FCS。

- 发送：

  - 发送端与接收端确定一个除数，该除数位数为n。

  - 发送端数据末尾加上 n+1 个0。

  - 用加上0后的数据除以除数，得到冗余码。

  - 冗余码作为FCS。

- 接收：

  - 将数据除以除数。
  - 如果冗余码为0，则数据传输正确。
  - 如果冗余码不为0，则认为数据错误。

检测到数据传输错误后并不纠错，即不要求重传。

CRC有**可能会检测不出**的错误，有可能数据错误错的多时恰好也能被整除。但是误判的概率较小。

## ppp协议

### 概述

point to point protocol的缩写，是**点到点信道**上常用的**协议**

特点：

- 简单（首要要求）
- 封装成帧
- 透明性
- 支持多种网络层协议
- 支持多种类型链路
- 差错检测
- 检测连接状态
- 最大传送单元
- 网络层地址协商
- 数据压缩协商

### 组成

ppp协议由分为三层，即链路层又分为三个小层。

- 网络控制协议（NCP， net control protocol）
- 链路控制协议（**LCP**， link control protocol）：具有身份验证等作用。
- 高级数据链路控制协议（HDLC，high-level data link control）

### 帧格式

<img src=".\图片\ppp协议帧.png" alt="ppp协议帧" style="zoom:50%;" />

帧头帧尾：0X7E，二进制为 `0111 1110` b。

0XFF 03：固定序列，表示地址。但是ppp协议是两点之间传输的协议，所以地址怎么写都无所谓，但是还是写上去了。

协议：信息部分的前两字节，用于表示信息部分是什么类型的数据。

FCS：frame check sequence，帧检验序列。

### 检验

#### 字节填充

如果碰到特殊字节，填充一个字节进行**转义**。

- 如果信息部分包含0X7E，则将其变为 0X7D 和 0X5E 两个字节。
- 如果信息部分包含0X7D，将其变为 0X7D 和 0X5D 两个字节
- 如果信息部分出现ASCII中的控制字符（小于0X20），在该字符前填充 0X7D，同时将该字符的编码加以改变。

#### 零比特填充

当**同步传输**时，即数据按为来传，而不是按字节来传。

为了透明传输：

- 发送端检测到连续5个1时，立刻在其后填入一个0，以避免产生连续6个1，即避免 0111 1110（0X7E）。
- 接收端检测到连续5个1时
  - 检测到其后有0，去掉0，把其当作信息。
  - 检测到其后没有0，是1，则数据为0X7D，是帧尾。
